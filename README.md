# 期货交易系统

一个基于Python和PyQt5开发的期货交易客户端系统，使用vnpy交易框架，支持国内主要期货交易所的实时交易。

## 功能特性

### 🔥 核心功能
- **实时行情监控** - 支持多合约实时行情显示
- **快速交易下单** - 支持限价单、开平仓操作
- **账户资金管理** - 实时显示资金状况和持仓信息
- **风险控制** - 持仓检查、价格偏离提醒
- **K线图表** - 期货合约走势图表显示

### 📊 交易功能
- **多空交易** - 支持做多和做空双向交易
- **开平仓操作** - 支持开仓、平仓、平今、平昨
- **快速下单** - 一键买卖按钮，提高交易效率
- **全撤功能** - 一键撤销所有未成交订单
- **委托管理** - 实时显示委托状态和成交记录

### 🏢 支持的交易所
- **上海期货交易所 (SHFE)** - 铜、镍等金属期货
- **大连商品交易所 (DCE)** - 农产品期货
- **郑州商品交易所 (CZCE)** - 农产品期货  
- **中国金融期货交易所 (CFFEX)** - 股指期货
- **上海国际能源交易中心 (INE)** - 原油期货

## 系统架构

### 技术栈
- **Python 3.x** - 主要开发语言
- **PyQt5** - GUI界面框架
- **vnpy** - 期货交易框架
- **CTP接口** - 连接期货公司交易系统

### 核心组件
```
├── ui/                     # 用户界面模块
│   ├── main.py            # 主窗口
│   ├── trading_component.py # 交易组件
│   ├── market_monitor.py   # 行情监控
│   ├── account_monitor.py  # 账户监控
│   ├── position_monitor.py # 持仓监控
│   ├── order_monitor.py    # 委托监控
│   └── trade_monitor.py    # 成交监控
├── config/                 # 配置模块
│   ├── config.py          # 系统配置
│   ├── subscribed_symbols.py # 订阅合约管理
│   └── log_manager.py     # 日志管理
├── gateways/              # 交易网关
└── tests/                 # 测试模块
```

## 安装部署

### 环境要求
- Python 3.7+
- Windows 操作系统（CTP接口要求）

### 依赖安装
```bash
pip install -r requirements.txt
```

### 主要依赖
```
PyQt5>=5.15.0
vnpy>=2.0.0
```

## 使用指南

### 启动系统
```bash
python ui/main.py
```

### 登录配置
1. 启动后会弹出登录对话框
2. 输入期货公司提供的账户信息
3. 选择CTP接口连接

### 交易操作

#### 1. 行情订阅
- 点击"查询合约"获取所有可交易合约
- 在合约列表中点击"订阅"按钮订阅行情
- 订阅的合约会在行情表格中实时显示

#### 2. 下单交易
**方式一：交易面板下单**
1. 选择交易所和合约代码
2. 设置交易方向（多/空）
3. 选择开平仓类型
4. 输入价格和数量
5. 点击"委托"按钮下单

**方式二：快速下单**
- 在行情表格中直接点击"买"/"卖"按钮
- 系统会自动填充合约信息到交易面板

#### 3. 撤单操作
- **单个撤单**：在委托监控中选择订单撤销
- **全部撤单**：点击"全撤"按钮撤销所有未成交订单

### 监控功能

#### 资金监控
- 显示总资金、可用资金、冻结资金
- 实时更新资金变化

#### 持仓监控  
- 显示当前持仓合约
- 实时计算持仓盈亏
- 区分多头和空头持仓

#### 委托监控
- 显示当前委托订单状态
- 支持订单撤销操作

#### 成交监控
- 显示成交记录
- 包含成交价格、数量、时间等信息

## 配置说明

### 订阅合约配置
系统会自动保存订阅的合约到 `config/subscribed_symbols.json`：
```json
{
    "symbols": [
        "sc2606.INE",
        "cu2506.SHFE", 
        "ni2502.SHFE"
    ]
}
```

### 日志配置
- 系统日志显示在主界面底部
- 支持交易操作日志记录
- 错误信息实时提示

## 风险提示

⚠️ **重要提醒**
- 期货交易具有高风险，可能导致资金损失
- 请在充分了解市场风险后使用本系统
- 建议先在模拟环境中测试
- 请确保网络连接稳定，避免交易中断

## 开发说明

### 项目结构
- 采用事件驱动架构，通过EventEngine处理实时数据
- 使用信号槽机制实现界面更新
- 模块化设计，便于功能扩展

### 扩展开发
- 可以添加新的交易所网关
- 支持自定义交易策略
- 可扩展技术指标和图表功能

## 故障排除

### 常见问题
1. **连接失败** - 检查网络连接和账户信息
2. **行情不更新** - 确认合约订阅状态
3. **下单失败** - 检查资金和持仓状况
4. **界面卡顿** - 减少订阅合约数量

### 技术支持
- 查看系统日志获取详细错误信息
- 检查CTP接口连接状态
- 确认期货公司服务器状态

## 文档

- [技术文档](docs/TECHNICAL.md) - 详细的技术实现说明
- [API文档](docs/API.md) - 完整的API接口参考

## 项目结构

```
vnpy-trading-system/
├── ui/                     # 用户界面模块
│   ├── main.py            # 主窗口
│   ├── trading_component.py # 交易组件
│   ├── market_monitor.py   # 行情监控
│   ├── account_monitor.py  # 账户监控
│   ├── position_monitor.py # 持仓监控
│   ├── order_monitor.py    # 委托监控
│   ├── trade_monitor.py    # 成交监控
│   └── widgets/           # UI组件
├── config/                 # 配置模块
│   ├── subscribed_symbols.py # 订阅管理
│   ├── tick_manager.py    # 行情管理
│   └── log_manager.py     # 日志管理
├── gateways/              # 交易网关
├── tests/                 # 测试模块
├── docs/                  # 文档目录
│   ├── TECHNICAL.md       # 技术文档
│   └── API.md            # API文档
├── requirements.txt       # 依赖列表
└── README.md             # 项目说明
```

## 许可证

本项目仅供学习和研究使用，请遵守相关法律法规。

---

**免责声明**：本软件仅为技术演示，使用者需自行承担交易风险。