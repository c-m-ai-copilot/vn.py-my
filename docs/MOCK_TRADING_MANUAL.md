# Mock交易系统使用手册

## 快速开始

### 1. 启动Mock交易系统
```bash
# Windows直接双击
start_mock.bat

# 或者手动启动
set USE_MOCK_DATA=true
python ui/new_main_window.py
```

### 2. 登录流程
**在Mock模式下，登录对话框会自动填充测试账户信息：**
- 用户名：mock_user
- 密码：mock_password
- 经纪商：MockCTP
- 地址：127.0.0.1:12345

**直接点击"登录"即可，无需修改任何配置**

## 系统界面介绍

### 主界面布局
```
┌─────────────────────────────────────────────────────────────┐
│  菜单栏：文件、交易、查询、帮助                               │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌───────────────────────────────────────┐  │
│  │  合约列表   │  │          行情监控面板                  │  │
│  │             │  │  显示实时价格、涨跌幅、成交量等         │  │
│  │  • rb2410   │  │                                     │  │
│  │  • cu2409   │  │                                     │  │
│  │  • au2412   │  │                                     │  │
│  └─────────────┘  └───────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  交易下单区域                                                │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 合约：rb2410  方向：买入开多  价格：3500  数量：10      │  │
│  │ [下单] [撤单]                                           │  │
│  └─────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐  │
│  │   持仓监控      │  │   订单监控      │  │   成交记录   │  │
│  │  显示当前持仓   │  │  显示挂单状态   │  │  显示成交   │  │
│  └─────────────────┘  └─────────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 功能测试指南

### 1. 行情订阅测试
**操作步骤：**
1. 在左侧合约列表中选择一个合约（如"rb2410 螺纹钢2410"）
2. 点击合约行中的"订阅"按钮
3. 观察右侧面板行情数据开始实时更新

**预期结果：**
- 最新价格每1秒更新一次
- 买卖盘数据正常显示
- 成交量和持仓量数字变化

### 2. 下单测试
**操作步骤：**
1. 在交易下单区域选择合约（如rb2410）
2. 选择方向：买入开多
3. 输入价格：3490（接近当前价）
4. 输入数量：1
5. 点击"下单"按钮

**预期结果：**
- 订单出现在订单监控面板
- 80%概率会成交（模拟真实市场）
- 成交后持仓面板显示新持仓
- 账户余额相应减少

### 3. 撤单测试
**操作步骤：**
1. 下一个限价单（价格设置远离当前价）
2. 在订单监控面板找到该订单
3. 点击"撤单"按钮

**预期结果：**
- 订单状态变为"已撤销"
- 冻结资金释放回可用余额

### 4. 持仓管理测试
**初始持仓：**
- 螺纹钢rb2410：10手多头，开仓价3490
- 沪铜cu2409：2手空头，开仓价70200
- 豆粕m2409：5手多头，开仓价2980

**测试操作：**
1. 查看持仓面板盈亏变化（随行情实时更新）
2. 双击持仓行进行平仓操作
3. 观察平仓后资金变化

### 5. 账户资金测试
**初始资金：**
- 总资产：1,000,000元
- 可用资金：800,000元
- 冻结资金：200,000元

**测试场景：**
1. 下大单测试资金不足提示
2. 观察持仓盈亏对总资产的影响
3. 测试手续费扣除（万分之一）

## 高级功能测试

### 1. 多合约同时监控
**操作：**
1. 同时订阅rb2410、cu2409、au2412
2. 观察行情面板多合约数据更新
3. 测试不同合约的下单撤单

### 2. 网络延迟模拟
**环境变量设置：**
```bash
# 设置500ms网络延迟
set MOCK_DELAY=500
start_mock.bat
```

### 3. 错误率测试
**环境变量设置：**
```bash
# 设置5%错误率
set MOCK_ERROR_RATE=0.05
start_mock.bat
```

## 常见问题解决

### Q1: 行情不更新怎么办？
**解决步骤：**
1. 确认已订阅合约（按钮显示"已订阅"）
2. 检查控制台是否有错误日志
3. 重启系统

### Q2: 订单无法成交怎么办？
**解决步骤：**
1. 检查价格是否在涨跌停范围内
2. 确认账户有足够资金
3. 调低价格贴近市场

### Q3: 如何重置账户？
**解决方法：**
关闭系统后重新启动，账户会自动重置为初始状态。

### Q4: 如何切换回真实交易？
**操作：**
```bash
# Windows
set USE_MOCK_DATA=false
python ui/new_main_window.py
```

## 测试数据验证

### 1. 验证行情数据
```python
# 在控制台观察输出
# 应该看到类似：
# [2024-07-22 14:30:01] MockTick: rb2410 最新价: 3492.0 涨跌幅: +0.2%
```

### 2. 验证订单系统
```python
# 下单后检查：
# [2024-07-22 14:30:15] MockOrder: 订单MOCK_1001已提交
# [2024-07-22 14:30:16] MockOrder: 订单MOCK_1001已成交 价格:3490 数量:1
```

### 3. 验证账户系统
```python
# 检查账户变化：
# [2024-07-22 14:30:20] MockAccount: 可用资金 799650.0 持仓盈亏: +200.0
```

## 性能测试

### 1. 压力测试
**同时操作：**
- 订阅5个合约
- 快速下10个订单
- 频繁切换界面

### 2. 内存监控
观察系统运行2小时后的内存占用情况。

## 技术支持

### 调试模式启动
```bash
# 启用详细日志
set MOCK_DEBUG=true
start_mock.bat
```

### 查看日志文件
日志文件保存在：`test_logs/mock_system.log`

### 联系支持
如遇到问题，请提供：
1. 错误截图
2. 控制台日志
3. 操作步骤描述

## 测试清单

### 基础功能 ✅
- [ ] 系统启动正常
- [ ] 登录对话框自动填充
- [ ] 合约列表显示完整
- [ ] 行情数据实时更新
- [ ] 下单功能正常
- [ ] 撤单功能正常
- [ ] 持仓显示正确
- [ ] 资金变化准确

### 高级功能
- [ ] 多合约同时监控
- [ ] 网络延迟模拟
- [ ] 错误率测试
- [ ] 性能压力测试

### 边界测试
- [ ] 资金不足提示
- [ ] 涨停跌停限制
- [ ] 重复撤单处理
- [ ] 异常输入处理

完成以上测试后，Mock交易系统即可投入日常使用。