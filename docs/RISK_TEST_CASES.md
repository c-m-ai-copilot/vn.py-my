# 风险管理测试用例文档

## 测试目标
验证风险管理系统的功能完整性、风险控制能力和稳定性，确保符合vn.py风险管理器标准。

## 测试环境准备

### 前置条件
- 系统已安装Python 3.7+
- 所有依赖已安装（`pip install -r requirements.txt`）
- vn.py框架已正确配置
- CTP模拟账户已准备

### 测试数据准备
- 确保网络连接正常（用于获取实时数据）
- 准备测试用资金账户数据
- 准备模拟交易数据用于测试风险控制

## 测试用例清单

### 1. 风险管理界面测试

#### TC-R01: 风险管理窗口打开测试
**测试目的**：验证风险管理窗口能正常打开
**前置条件**：主程序已启动
**测试步骤**：
1. 启动主程序：`python ui/main.py`
2. 点击主界面右上角的"风险管理"按钮
3. 观察窗口是否成功打开

**预期结果**：
- [ ] 风险管理窗口成功打开
- [ ] 窗口标题显示"风险管理"
- [ ] 窗口包含风险概览、警报、规则等完整界面

**测试数据**：无

#### TC-R02: 风险概览显示测试
**测试目的**：验证风险概览信息正确显示
**前置条件**：风险管理窗口已打开
**测试步骤**：
1. 打开风险管理窗口
2. 观察左侧风险概览区域
3. 检查今日盈亏、风险评分等关键指标

**预期结果**：
- [ ] 显示今日盈亏金额
- [ ] 显示风险评分（0-100分）
- [ ] 显示当前持仓、挂单、成交数量
- [ ] 显示风险警报数量

### 2. 风险设置测试

#### TC-R03: 风险参数配置测试
**测试目的**：验证风险参数能正确配置和保存
**前置条件**：风险管理窗口已打开
**测试步骤**：
1. 点击"风险设置"按钮
2. 修改以下参数：
   - 单笔最大亏损：500
   - 每日最大亏损：2000
   - 最大仓位比例：0.6
   - 最小账户余额：5000
3. 点击"保存"按钮

**预期结果**：
- [ ] 弹出成功提示："风险设置已保存"
- [ ] 参数保存到配置文件
- [ ] 新设置立即生效

#### TC-R04: 风险参数重置测试
**测试目的**：验证能将风险参数重置为默认值
**前置条件**：已修改过风险设置
**测试步骤**：
1. 打开风险设置对话框
2. 点击"重置为默认"按钮
3. 在确认对话框中点击"是"

**预期结果**：
- [ ] 弹出确认对话框
- [ ] 重置成功后自动加载默认值
- [ ] 默认参数包括：单笔最大亏损1000元、每日最大亏损5000元等

### 3. 风险控制功能测试

#### TC-R05: 单笔交易风险控制测试
**测试目的**：验证单笔交易风险控制功能
**前置条件**：已设置单笔最大亏损为1000元
**测试步骤**：
1. 设置单笔最大亏损为1000元
2. 进行交易，单笔亏损超过1000元
3. 观察系统响应

**预期结果**：
- [ ] 触发风险警报
- [ ] 产生警告提示
- [ ] 如果启用自动止损，阻止该笔交易

#### TC-R06: 每日亏损风险控制测试
**测试目的**：验证每日累计亏损控制功能
**前置条件**：已设置每日最大亏损为5000元
**测试步骤**：
1. 设置每日最大亏损为5000元
2. 进行多笔交易使累计亏损超过5000元
3. 观察系统响应

**预期结果**：
- [ ] 触发每日亏损警报
- [ ] 系统显示风险评分下降
- [ ] 如启用自动止损，暂停当日交易

#### TC-R07: 仓位风险控制测试
**测试目的**：验证仓位比例风险控制功能
**前置条件**：已设置最大仓位比例为50%
**测试步骤**：
1. 进行交易使持仓比例接近50%
2. 继续交易试图超过50%仓位
3. 观察系统响应

**预期结果**：
- [ ] 触发仓位风险警报
- [ ] 系统计算并显示当前仓位比例
- [ ] 阻止超过设定比例的交易

#### TC-R08: 集中持仓风险控制测试
**测试目的**：验证单一品种集中持仓风险控制
**前置条件**：已设置最大集中持仓比例为30%
**测试步骤**：
1. 大量买入单一品种使其占比超过30%
2. 继续买入该品种
3. 观察系统响应

**预期结果**：
- [ ] 触发集中度风险警报
- [ ] 显示该品种的持仓占比
- [ ] 阻止继续加仓该品种

### 4. 账户风险控制测试

#### TC-R09: 账户余额风险控制测试
**测试目的**：验证账户余额风险控制功能
**前置条件**：已设置最小账户余额为10000元
**测试步骤**：
1. 设置最小账户余额为10000元
2. 进行交易使账户余额低于10000元
3. 观察系统响应

**预期结果**：
- [ ] 触发账户余额不足警报
- [ ] 显示当前账户余额
- [ ] 阻止可能导致余额过低的交易

#### TC-R10: 杠杆倍数风险控制测试
**测试目的**：验证杠杆倍数风险控制功能
**前置条件**：已设置最大杠杆倍数为10倍
**测试步骤**：
1. 设置最大杠杆倍数为10倍
2. 试图进行超过10倍杠杆的交易
3. 观察系统响应

**预期结果**：
- [ ] 触发杠杆风险警报
- [ ] 显示当前杠杆倍数
- [ ] 阻止超过设定杠杆的交易

### 5. 风险警报系统测试

#### TC-R11: 风险警报显示测试
**测试目的**：验证风险警报能正确显示和记录
**前置条件**：已触发风险事件
**测试步骤**：
1. 故意触发一个风险事件（如大额亏损）
2. 观察风险管理界面
3. 检查警报列表

**预期结果**：
- [ ] 立即显示警报信息
- [ ] 警报包含时间、级别、消息内容
- [ ] 警报持久化保存到文件

#### TC-R12: 风险警报级别测试
**测试目的**：验证不同级别风险警报的显示
**前置条件**：设置启用警报
**测试步骤**：
1. 触发不同类型的风险事件
2. 观察警报级别显示（WARNING、ERROR）
3. 检查警报的颜色区分

**预期结果**：
- [ ] WARNING级别显示黄色背景
- [ ] ERROR级别显示红色背景
- [ ] 警报级别与严重程度匹配

### 6. 风险评分测试

#### TC-R13: 风险评分计算测试
**测试目的**：验证风险评分算法正确性
**前置条件**：有持仓和交易记录
**测试步骤**：
1. 观察初始风险评分（应为100分）
2. 进行亏损交易
3. 观察评分下降情况

**预期结果**：
- [ ] 初始评分为100分
- [ ] 每次风险事件后评分下降
- [ ] 评分范围0-100分
- [ ] 评分颜色：绿色(≥80)、橙色(60-79)、红色(<60)

#### TC-R14: 风险评分阈值测试
**测试目的**：验证风险评分阈值功能
**前置条件**：已设置风险评分阈值为70分
**测试步骤**：
1. 设置阈值为70分
2. 使风险评分降至70分以下
3. 观察系统响应

**预期结果**：
- [ ] 评分低于阈值时触发警报
- [ ] 系统提示风险过高
- [ ] 如启用自动保护，限制交易

### 7. 实时风险监控测试

#### TC-R15: 实时数据更新测试
**测试目的**：验证风险状态实时更新功能
**前置条件**：风险管理窗口已打开
**测试步骤**：
1. 进行交易操作
2. 观察风险管理界面更新频率
3. 检查各项数据的实时性

**预期结果**：
- [ ] 每5秒自动刷新一次
- [ ] 数据更新及时准确
- [ ] 界面无卡顿现象

#### TC-R16: 每日盈亏重置测试
**测试目的**：验证每日盈亏重置功能
**前置条件**：当日有交易记录和盈亏数据
**测试步骤**：
1. 点击"重置盈亏"按钮
2. 在确认对话框中点击"是"
3. 观察盈亏数据变化

**预期结果**：
- [ ] 弹出确认对话框
- [ ] 盈亏数据重置为0
- [ ] 历史交易记录清除

### 8. 集成测试

#### TC-R17: 与主系统交互测试
**测试目的**：验证风险系统与主交易系统的集成
**前置条件**：主系统已连接CTP服务器
**测试步骤**：
1. 在主系统进行正常交易
2. 观察风险系统同步情况
3. 检查持仓、成交数据的一致性

**预期结果**：
- [ ] 主系统交易数据实时同步到风险系统
- [ ] 风险警报能正确影响主系统操作
- [ ] 数据一致性良好

#### TC-R18: 多品种风险控制测试
**测试目的**：验证多品种持仓的风险控制
**前置条件**：持有多个品种的仓位
**测试步骤**：
1. 同时持有3-5个不同品种
2. 检查集中度和仓位比例计算
3. 验证风险控制对多品种都有效

**预期结果**：
- [ ] 正确计算每个品种的占比
- [ ] 总仓位比例计算准确
- [ ] 对每个品种单独进行风险控制

### 9. 异常情况测试

#### TC-R19: 网络中断测试
**测试目的**：验证网络中断时的风险控制处理
**前置条件**：正常连接到服务器
**测试步骤**：
1. 断开网络连接
2. 观察风险系统反应
3. 重新连接网络后检查数据完整性

**预期结果**：
- [ ] 网络中断时暂停风险监控
- [ ] 重连后自动恢复监控
- [ ] 数据不丢失

#### TC-R20: 大额资金变动测试
**测试目的**：验证大额资金变动的风险控制
**前置条件**：账户有较大资金余额
**测试步骤**：
1. 进行大额出入金操作
2. 观察账户余额风险控制响应
3. 检查风险控制阈值调整

**预期结果**：
- [ ] 大额资金变动能及时识别
- [ ] 风险控制阈值动态调整
- [ ] 系统稳定性良好

## 测试执行记录表

| 测试用例 | 执行日期 | 执行人 | 结果 | 备注 |
|----------|----------|--------|------|------|
| TC-R01 | | | ☐/☐ | |
| TC-R02 | | | ☐/☐ | |
| TC-R03 | | | ☐/☐ | |
| TC-R04 | | | ☐/☐ | |
| TC-R05 | | | ☐/☐ | |
| TC-R06 | | | ☐/☐ | |
| TC-R07 | | | ☐/☐ | |
| TC-R08 | | | ☐/☐ | |
| TC-R09 | | | ☐/☐ | |
| TC-R10 | | | ☐/☐ | |
| TC-R11 | | | ☐/☐ | |
| TC-R12 | | | ☐/☐ | |
| TC-R13 | | | ☐/☐ | |
| TC-R14 | | | ☐/☐ | |
| TC-R15 | | | ☐/☐ | |
| TC-R16 | | | ☐/☐ | |
| TC-R17 | | | ☐/☐ | |
| TC-R18 | | | ☐/☐ | |
| TC-R19 | | | ☐/☐ | |
| TC-R20 | | | ☐/☐ | |

## 测试注意事项

1. **安全第一**：测试时务必使用模拟账户，避免真实资金风险
2. **逐步测试**：建议按顺序逐步执行测试用例
3. **参数记录**：详细记录每个测试步骤的参数设置
4. **异常收集**：遇到任何异常都要详细记录错误信息
5. **环境隔离**：测试环境与生产环境完全隔离

## 测试完成标准

- [ ] 所有功能测试用例通过
- [ ] 风险控制机制工作正常
- [ ] 警报系统准确及时
- [ ] 界面显示完整无错误
- [ ] 与主系统集成良好
- [ ] 异常情况处理正确
- [ ] 性能满足实时要求

## 测试后清理

1. 重置所有风险设置为默认值
2. 清除测试期间产生的警报记录
3. 备份测试数据和配置文件
4. 生成测试报告
5. 如需，恢复原始系统状态